
\- UCOMPARE : UCOMPARE COMPARE ;
22 CELLS CONSTANT VIEW_FSTACK_SIZE
CREATE VIEW_FSTACK 0 , 0 , VIEW_FSTACK_SIZE ALLOT

: SNFAFIND ( addr len --- 0| nfa )
  CONTEXT
  BEGIN	DUP @ \ DUP H.
  WHILE	>R
	2DUP  R@  @  SEARCH-NFA ?DUP
	IF    RDROP NIP NIP EXIT \ Exit if found.
	THEN
	R> CELL+
  REPEAT @ NIP NIP
;

: VIEWS_SEARCH  ( adr len -- path | 0  )
  SNFAFIND
 DUP 0= IF BREAK
  VIEW_LINK
 BEGIN  DUP
 WHILE
	2DUP U> IF 2DROP  VIEW_FSTACK @ CELL+ CELL+ BREAK
	DUP CELL+ @ 
	IF   VIEW_FSTACK VIEW_FSTACK CELL+ VIEW_FSTACK_SIZE MOVE
	      DUP VIEW_FSTACK !
	ELSE VIEW_FSTACK CELL+  VIEW_FSTACK VIEW_FSTACK_SIZE MOVE
	THEN
	@
 REPEAT NIP
;

\- VIEW#Y0	0 VALUE VIEW#Y0
\- $EDIT	VECT $EDIT ' 2DROP TO $EDIT

: E>   PARSE-NAME VIEWS_SEARCH ?DUP
  IF  SWAP TO VIEW#Y0 COUNT $EDIT  THEN  
;

\ VIEWS_TYPE 
\ S" M@" VIEWS_SEARCH.
  ' dump TO $EDIT
\ E> +


